!function(t,e,i){var s=i.Basic.typeOf,o={overlay:null,templates:{parent:null},touchSupport:!1};i.Basic.Constructors.getView(function(){function e(t){var e=window.scrollTo||window.scroll;"undefined"==typeof t&&(t=h,h=null),null===t||isNaN(t)||e(0,t)}function o(t){delete this._state.cancelableActions,this._overlay.toggleBlock(this._elems.parent,t),this._state.visible=t,this._trigger(t?"show":"hide")}function n(){var t=!1;return this._state.cancelableActions||(this._state.cancelableActions={show:function(){t||o.call(this,!0)}.bind(this),hide:function(){t||o.call(this,!1)}.bind(this),cancel:function(){t=!0,delete this._state.cancelableActions}.bind(this)}),this._state.cancelableActions}function l(t,e){if(t!==this._state.visible)if(s(e,"object")&&s(e.then,"function")){var i=n.call(this),h=i[t?"show":"hide"];this._overlay.showLoading(e,i.cancel),e.then(h,l.bind(this,!t))}else o.call(this,t)}var h=null;return{_Events:["show","hide"],_parentElement:function(){var e=Array.prototype.slice.call(arguments,0);return t(this._opts.templates.parent.apply(this,e))},_Init:function(){var t=i.Tools.initModule("OverlayManager"),e=t.getById(this._opts.overlay);e.registerBlock(this),this._overlay=e,this._state={visible:!1,preventClose:this._opts.preventClose===!0}},getBlockElement:function(){return this._elems.parent},getOverlay:function(){return this._overlay},toggle:function(t,e){l.call(this,t,e)},show:function(t){h||(h=window.scrollY),l.call(this,!0,t),this._opts.touchSupport&&e(0)},hide:function(t){this._state.preventClose||(l.call(this,!1,t),this._opts.touchSupport&&setTimeout(e,10))},destroy:function(){l.call(this,!1),this._elems.parent.remove()}}}(),o,null,"Popup")}(this.jQuery||this.$||this.$f,this,this.ru.mail.cpf),function(t,e,i){"use strict";var s=i.Basic.typeOf,o=i.Tools.Layout,n=i.Tools.PubSub,l=i.Tools.detectPointerType,h="Overlay",r={cssSels:{parent:".js-popup",Main:{blocksCont:".js-popup_blocks"},sizeReference:".js-size-reference",sizeReferenceWrapper:".js-size-reference__wrapper",close:".js-popup_close",preventClose:".js-popup_noclose"},cssClss:{htmlModifier:null,overlayModifier:null,loading:null,hideBlocks:"hidden_all"},templates:{parent:null},touchSupport:!1},a=i.Basic.Constructors.getModel({_Events:["push","pop","empty"],indexOf:function(t){var e=Array.prototype.indexOf.call(this,t);return-1===e&&"block"in t&&this.some(function(i,s){return i.block===t.block?(e=s,!0):void 0}),e},push:function(t){var e=this.indexOf(t);e>-1&&this.splice(e,1),Array.prototype.push.call(this,t),this._trigger("push")},exclude:function(t){var e=this.indexOf(t),i=this.length-1;e>-1&&(this.splice(e,1),e===i&&this._trigger("pop",this.getTopItem()),0===this.length&&this._trigger("empty"))},pop:function(){this._trigger("pop",Array.prototype.pop.call(this))},getTopItem:function(){return this.slice(-1)[0]},empty:function(){if(0!==this.length){for(;this.length>1;)Array.prototype.pop.call(this);this._trigger("empty")}}},null,Array),c=i.Basic.Constructors.getView(function(){function i(){var t;if(this._visibilityStack.length>0)for(;t=this._visibilityStack.getTopItem();)t.hide()}function n(t){t=s(t,"boolean")?t:!this._state.visible,t!==this._state.visible&&(_.toggleClass(this._opts.cssClss.htmlModifier,t),this._Elems.parent.toggleClass(this._opts.cssClss.overlayModifier,t).toggle(t),t||i.call(this),f.call(this,t),this._state.visible=t,this._trigger(t?"show":"hide"))}function l(t){t&&t.show()}function h(t){d.call(this,t.block),this._visibilityStack.push(t)}function r(t){this._visibilityStack.exclude(t)}function c(t){this._state.loading=t,this._Elems.parent.toggleClass(this._opts.cssClss.loading,t),t&&this._trigger("loading")}function u(t,e){this._state.loading!==t&&(e&&this._visibilityStack[t?"push":"exclude"](e),c.call(this,t),t||this._visibilityStack.length||this.hide())}function p(){function t(){var t=l.find(c).first(),e=t.find(a).first(),i=e.get(0),s=t.get(0);return i?{el:i,parent:s}:{el:r,parent:h}}function i(e,i){if(0===r.clientHeight){var s=t();r=s.el,h=s.parent}var n=o.getScroll(h),l=r.clientWidth-h.clientWidth,a=r.clientHeight-h.clientHeight;(l>0||a>0)&&(n.left=Math.max(Math.min(n.left+e,l),0),n.top=Math.max(Math.min(n.top+i,a),0),o.setScroll(n,h))}var s,n=this._elems.parent,l=this._elems.blocksCont,h=n.get(0),r=l.get(0),a=this._opts.cssSels.sizeReference,c=this._opts.cssSels.sizeReferenceWrapper;return function(t){var o,n;t.touches?(o=t.touches[0].pageX,n=t.touches[0].pageY):(o=t.pageX,n=t.pageY),"touchmove"===t.type&&(t.preventDefault(),e.requestAnimationFrame(i.bind(null,s.x-o,s.y-n))),s={x:o,y:n}}}function f(t){t?(document.body.addEventListener("touchstart",this._emulateScroll,!0),document.body.addEventListener("touchmove",this._emulateScroll,!0)):(document.body.removeEventListener("touchstart",this._emulateScroll,!0),document.body.removeEventListener("touchmove",this._emulateScroll,!0))}function d(t){var e=this._elems.blocksCont,i=t.getBlockElement(),s=-1===Array.prototype.indexOf.call(i.parents(),e[0]);s&&e.append(i)}var _=t(e.document.documentElement);return{_Events:["show","hide","loading"],_Handlers:{dom:{"keydown:document":function(t){27===t.keyCode&&this._state.visible&&this.hide()},"click:close":function(e){var i=t(e.target),s=t(e.currentTarget),o=[this._opts.cssSels.Main.blocksCont,this._opts.cssSels.preventClose];if(this._visibilityStack.length){if(o.filter(function(t){return i.parents(t).length&&!s.parents(t).length}).length)return;e.preventDefault(),this._visibilityStack.getTopItem().hide()}else e.preventDefault(),this.hide()}}},_parentElement:function(){var i=t(this._opts.cssSels.parent).eq(0);return i.length&&i||e.document.body.appendChild(t(this._opts.templates.parent()).get(0))},_Init:function(){this._state={visible:!1,loading:!1,touchSupport:!1},this._visibilityStack=new a({_Handlers:{pop:l.bind(this),empty:this.hide.bind(this)}}),this._opts.touchSupport&&this._enableTouchSupport(),this._elems.blocksCont=this._elems.blocksCont||this._elems.parent},_enableTouchSupport:function(){this._state.touchSupport=!0,this._emulateScroll=p.call(this),this._state.visible&&f.call(this,!0)},show:function(){n.call(this,!0)},hide:function(){n.call(this,!1)},registerBlock:function(t){d.call(this,t);var e={show:function(){this.toggleBlock(t.getBlockElement(),!0)}.bind(this),hide:function(){t.hide()}.bind(this),block:t};t.on("show",h.bind(this,e)),t.on("hide",r.bind(this,e))},showLoading:function(t,e){var i={show:c.bind(this,!0),hide:function(){c.call(this,!1),s(e,"function")&&e(),r.call(this,i)}.bind(this)},o=u.bind(this,!1,i);this._state.loadingBlock=i,u.call(this,!0,i),this._state.visible||this.show(),s(t,"object")&&s(t.then,"function")&&t.then(o,o)},toggleBlock:function(t,e){e=e===!0;var i=this._opts.cssClss.hideBlocks,s=this._elems.blocksCont.children();i?(s.toggleClass(i,!0),t.toggleClass(i,!e)):(s.hide(),t.toggle(e)),e&&(this._state.loading&&u.call(this,!1,this._state.loadingBlock),this._state.visible||this.show())},empty:function(){this._visibilityStack.empty()},stackSize:function(){return this._visibilityStack.length}}}(),r,null,h);i.Basic.Constructors.getModel(function(){var t;return{_Init:function(){return t?t:(this._state={isTouchDevice:!1},t=this,n&&l&&o&&n.subscribe(l("touch").message,function(){this._state.isTouchDevice=!0,this.propogateDeviceType()}.bind(this),{async:!1,memory:!0}),void(this._overlays={}))},getById:function(){var t=Array.prototype.slice.call(arguments),e=s(t[0],"object"),o=e?t[0].id:t[0],n=e?t[0].options:{},l=this._overlays[o];return l||(l=this._overlays[o]=i.Tools.initModule([h,o],null,n)),l},propogateDeviceType:function(){var t;for(var e in this._overlays)this._overlays.hasOwnProperty(e)&&(t=this._overlays[e])&&t instanceof c&&t._enableTouchSupport()}}}(),null,null,"OverlayManager")}(this.jQuery||this.$||this.$f,this,this.ru.mail.cpf),function(t,e,i){"use strict";var s="Popup",o="PopupLegacy",n="_popupObj",l=i.Basic.Constructors.addPlugin,h=i.Tools.initModule,r=i.Basic.Constructors._repo.get(s),a=function(t){return t},c={beforeShow:a,onShow:a,onHide:a};l(s,function(){return{_Handlers:{self:{hide:function(){this._opts.onHide.call(this)},show:function(){this._opts.onShow.call(this)}}},_Init:function(){var t=this._elems.parent.data(n);return t instanceof r?t:(this._elems.parent.data(n,this),void(this._elems.jBlock=this._elems.parent))},Toggle:function(t,e){if(("undefined"==typeof e||null===e)&&(e={}),t!==this._state.visible&&(t||!this._state.preventClose)){var i=Promise.resolve({});return t?(this._state.preventClose=!!e.preventClose,i=i.then(this._opts.beforeShow.bind(this)),"function"==typeof e.beforeShow&&(i=i.then(e.beforeShow.bind(this))),"function"==typeof e.onShow&&(i=i.then(e.onShow.bind(this))),"function"==typeof e.onHide&&this.once("hide",e.onHide.bind(this))):("function"==typeof e.onHide&&(i=i.then(e.onHide.bind(this))),"function"==typeof e.onShow&&this.once("show",e.onShow.bind(this))),this.toggle(!!t,i)}},Show:function(t){return this.Toggle(!0,t)},Hide:function(t){return this.Toggle(!1,t)},togglePreload:function(t,e){"function"==typeof e?this._overlay.showLoading(e):this._overlay.showLoading(Promise.resolve({}))},bind:function(){var t=Array.prototype.slice.call(arguments,0);return this.on.apply(this,t)}}}(),c,o),t.fn.Popup=function(e,i,s){var o=t(this),n=h("Popup",o,e);return"string"==typeof i&&"function"==typeof n[i]&&n[i](s||{}),o}}(this.jQuery||this.$,this,this.ru.mail.cpf),function(t){"use strict";var e=t.Basic.moduleOpts.setParams;e("Overlay",{options:{cssClss:{htmlModifier:"popup-shown",loading:"overlay_loading"}}}),e("Popup",{options:{cssClss:{ppShwn:"popup-shown",bannerShown:"overlay_banner"}}}),e("Popup.ImageView",{options:{overlay:"ImageView"}}),e("Overlay.ImageView",{options:{cssSels:{parent:".js-popup_gallery"},cssClss:{htmlModifier:"popup-shown",loading:"overlay_loading"}}})}(this.ru.mail.cpf);
