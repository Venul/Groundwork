!function(e,t,n){"use strict";var r=n.Basic,a=n.Tools.getTemplate,s="FoundMistake",o={url:"/ajax/feedback/",templates:{form:"ct-feedback.xml"}};r.getView(function(){function r(){var n,r,a,s,o,i=!("getSelection"in t),l=i?document.selection.createRange():t.getSelection(),d=e(i?l.parentElement():l.anchorNode);if(!d.closest(this._Elems.Parent)||"None"===l.type)return!1;if(i)l.expand("word"),n=t.document.selection.createRange(),n.moveStart("character",-20),n.setEndPoint("EndToStart",l),n.expand("word"),r=n.text,n.moveEnd("character",20),n.setEndPoint("StartToEnd",l),n.expand("word"),a=n.text,s=l.text;else{if(!l.getRangeAt)return!1;o=l.getRangeAt(0),n=document.createRange(),n.setStartBefore(o.startContainer),n.setEnd(o.startContainer,o.startOffset),r=n.toString(),r.length>30&&(r=r.substr(r.length-30).replace(/^\S{1,10}\s+/,"")),n.setStart(o.endContainer,o.endOffset),n.setEndAfter(o.endContainer),a=n.toString(),a.length>30&&(a=a.substr(0,30).replace(/\s+\S{1,10}$/,"")),s=l.toString()}return{text:[r,"[",s,"]",a].join("").replace(/\r?\n?/g,""),selectionText:s}}return{_Events:[],_Handlers:{dom:{"keydown:document":"_onKeydown"}},_onKeydown:function(e){if(e.ctrlKey&&13==e.keyCode){var s=this._Opts,o=r.call(this);if(e.preventDefault(),o.text){var i=new n.Modules.AsyncForms({serverApi:{send:{url:s.url}},Templates:{form:a(s.templates.form)},validateOnChange:!1,templateParams:{mistake:!0,lnk:t.location.href,text:o.text,isBigMsg:o.selectionText.length>90}},null);i.Show()}}}}}(),o,null,s);r.moduleOpts.setParams({paramAttrs:{url:"data-action"}}),r.Extend(!0,n,{Modules:{FoundMistake:s}})}(this.jQuery||this.$||this.$f,this,this.ru.mail.cpf);
