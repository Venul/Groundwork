document.querySelectorAll||(document.querySelectorAll=function(t){var e,i=document.createElement("style"),o=[];for(document.documentElement.firstChild.appendChild(i),document._qsa=[],i.styleSheet.cssText=t+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),i.parentNode.removeChild(i);document._qsa.length;)e=document._qsa.shift(),e.style.removeAttribute("x-qsa"),o.push(e);return document._qsa=null,o}),document.querySelector||(document.querySelector=function(t){var e=document.querySelectorAll(t);return e.length?e[0]:null}),function(){function t(){var e={},i=!1,o=null,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(i=arguments[0],o++);var s=function(o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(i&&"[object Object]"===Object.prototype.toString.call(o[n])?e[n]=t(!0,e[n],o[n]):e[n]=o[n])};for(o=0;o<n;o++){var r=arguments[o];s(r)}return e}function e(t){var e=t.getBoundingClientRect(),i=document.body;return{top:e.top+i.scrollTop,left:e.left+i.scrollLeft}}function i(t,e){for(var i=t.className?t.className.split(" "):[],o=0;o<i.length;o++)if(i[o]==e)return;i.push(e),t.className=i.join(" ")}function o(t,e){for(var i=t.className.split(" "),o=0;o<i.length;o++)i[o]==e&&(i.splice(o,1),o--);t.className=i.join(" ")}function n(t){var e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0}function s(t,e,i){var o=null;return e=e||100,function(){function n(){i||t.apply(s,r),o=null}var s=this,r=arguments;null!==o?clearTimeout(o):i&&t.apply(s,r),o=setTimeout(n,e)}}function r(t){t=t||600;var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(e<=t)return!0;for(var i=navigator.userAgent,o=[/iPhone/i,/iPod/i,/iPad/i,/Android/i,/IEMobile/i,/(?=.*\bWindows\b)(?=.*\bARM\b)/i,/BlackBerry/i,/BB10/i,/Opera Mini/i,/(CriOS|Chrome)(?=.*\bMobile\b)/i,/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,/(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)/i],n=0,s=o.length;n<s;++n)if(o[n].test(i))return!0;return!1}window._mediatorUtils=t(window._mediatorUtils||{},{extend:t,offset:e,addClass:i,removeClass:o,getCookie:n,debounce:s,isMobile:r})}(),function(){"use strict";function t(){var t=b.referrer,e="";return t&&(e=t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0],e=e.split(":")[0]),e}function e(){var t=this._opts,e=this._opts.style,i=b.createElement("div"),o=b.createElement("span");return o.style.cssText=e.label,i.appendChild(o),C(i,t.cssClss.mark),i.style.cssText=e.mark,i}function i(t,e){var i="",o=this._state.lang,n=q[o];return i=t<e-1?n.start+" "+n.section+" "+t:t==e?n.start+" "+n.footer:n.end+" "+n.section+" "+(t-1)}function o(){var t,o=this._marks,n=this._nodes;if(n||(n=[]),this._opts.showRule){var s=[],r=b.createDocumentFragment(),l="",a=Math.max(n.length,o.length);for(t=0;t<a;t++){var c=o[t],u=n[t];c?(u||(u=e.call(this),r.appendChild(u)),u.style.top=c.pos+"px",l=i.call(this,t+1,o.length),u.firstChild.textContent=l,u.firstChild.innerText=l,s[t]=u):u&&b.body.removeChild(u)}b.body.appendChild(r),this._nodes=s}else if(n.length){for(t=0;t<n.length;t++)b.body.removeChild(n[t]);this._nodes=null}}function n(){var t,e,i,o,n,s=this._elems,r=this._opts,l=this._state,a=this._sizes,c=this._marks;if(r.sectionByClass)for(t=s.section.length,e=t+1,i=0;i<=t;i++){var u=i==t?i-1:i;n={start:a.section[u].rect.top,end:a.section[u].rect.bottom},o=c[i],o||(o={events:{}}),o.pos=i==t?n.end:n.start,o.start=o.pos+r.section.triggerStep,c[i]=o}else{t=r.section.count;var d=l.sectionHeight=a.article.rect.height/t;for(n={start:a.article.rect.top,end:a.article.rect.bottom},d<r.section.minHeight&&(t=Math.floor(a.article.rect.height/r.section.minHeight),d=a.article.rect.height/t),e=t+1,i=0;i<e;i++)o=c[i],o||(o={events:{}}),o.pos=i==t?n.end:n.start+d*i,o.start=o.pos+r.section.triggerStep,c[i]=o}c[e]||(c[e]={events:{}}),c[e].pos=s.footer?a.footer.rect.top:b.documentElement.scrollHeight}function s(){function t(t){var e=t.getBoundingClientRect();return{rect:{left:e.left,right:e.right,top:e.top+i,bottom:e.bottom+i,width:e.width||e.right-e.left,height:e.height||e.bottom-e.top},offset:y(t)}}var e=this._elems;this._sizes={};var i=window.pageYOffset||b.body.scrollTop||b.documentElement.scrollTop;for(var o in e)if(e.hasOwnProperty(o)){var n=e[o];if(n)if(n.length){this._sizes.section=[];for(var s=0;s<n.length;s++)this._sizes.section[s]=t(n[s])}else this._sizes[o]=t(n)}}function r(){n.call(this),o.call(this)}function l(){s.call(this),r.call(this),a.call(this)}function a(){if(this._activePage&&!this._state.initing){var t=this._elems,e=this._state,i=this._opts,o=this._marks,n=this._sizes,s=window.pageYOffset||b.body.scrollTop||b.documentElement.scrollTop,r=window.innerHeight||b.documentElement.clientHeight||b.body.clientHeight;t.parent!=b.body&&(s=t.parent.offsetTop,r=Math.min(r,t.parent.clientHeight));for(var l=s+r*i.triggerArea,a=s+r,c=i.sectionByClass?this._elems.section.length:i.section.count,d=i.sectionByClass?o[c].pos:n.article.rect.bottom,p={reading:e.readingSection,current:null},f=0;f<o.length;f++){var g=o[f];if(g.pos<a){var m=g.events;m.scroll||(h.call(this,{type:"s"+(f==o.length-1?"f":f)}),m.scroll=!0),f<c&&g.start<l&&(p.current=f)}}d<s&&(p.current=null),p.current!=p.reading&&(e.readingSection=p.current,u.call(this))}}function c(){var t=this._opts;t.isMobile=t.adaptive?S():!!t.touchCounter}function u(){var t=this._state,e=this._marks,i=this._opts.timeouts.hit;t._timer&&clearTimeout(t._timer),"number"==typeof t.readingSection&&(t._timer=setTimeout(function o(){var n=t.readingSection;this._activePage&&"number"==typeof n&&(e[n].events.read||(h.call(this,{type:"ts"+n}),e[n].events.read=!0),h.call(this,{type:"t"+n})),t._timer=setTimeout(o.bind(this),i)}.bind(this),i))}function d(){var t=b.documentElement.scrollHeight,e=this._opts.timeouts.height,i=this._elems,o=this._opts;(function n(){var s=b.documentElement.scrollHeight;s!=t&&(t=s,o.sectionByClass&&(i.section=i.parent.querySelectorAll(o.cssSels.section)),l.call(this)),setTimeout(n.bind(this),e)}).bind(this)()}function h(t){var e=this._state,i=this._opts,o=i.isMobile?i.touchCounter:i.counter,n={id:o,type:"sendEvent",action:e.pathname,label:e.referrer,category:t.type,value:1};window._tmr&&window._tmr.push(n),this._opts.debug&&console.log(n),"function"==typeof i.onPushEvent&&i.onPushEvent(n)}function p(){var t=b.location.hash.slice(1);t!==this._opts.hashes.showRule&&t!==this._opts.hashes.debug||(this._opts.showRule=!0,o.call(this)),t===this._opts.hashes.debug&&(this._opts.debug=!0)}function f(t,e){"boolean"!=typeof t&&(t=!b.hidden),this._activePage=t,this._opts.debug&&(console.log("Медиатор: активность окна "+t+(e?" ("+e+")":"")),b.title=t+(e?" ("+e+")":"")),t&&a.call(this)}function g(){var t=this._elems.parent,e=this._opts.timeouts,i=a.bind(this),o=l.bind(this),n=p.bind(this),s=!window.addEventListener,r=function(t,e,i){i=i||window;for(var o=t.split(" "),n=0;n<o.length;n++){var r=o[n];"visibilitychange"==r?"hidden"in b?b.addEventListener(r,e):"mozHidden"in b?(r="mozvisibilitychange",b.addEventListener(r,e)):"webkitHidden"in b?(r="webkitHidden",b.addEventListener(r,e)):"webkitvisibilitychange"in b?(r="webkitvisibilitychange",b.addEventListener(r,e)):"msHidden"in b?(r="msHidden",b.addEventListener(r,e)):"onfocusin"in b?b.onfocusin=b.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e:s?(r="on"+r,i.attachEvent(r,e)):i.addEventListener(r,e)}};r("resize",E(o,e.resize)),b.body!==t?r("scroll",E(function(){o(),i()},e.scroll),t):r("scroll",E(i,e.scroll)),r("load",o),r("hashchange",n),r("visibilitychange blur focus",function(t){var e=null;t=t||window.event;var i={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1},o=t.type;e=o in i?i[o]:!b.hidden,this._activePage=e,f.call(this,e,o)}.bind(this)),r("load resize scroll click touchstart keydown hashchange",E(function(t){t=t||window.event,f.call(this,null,t.type)}.bind(this),300,!0))}function m(){var e=this._opts,i=t(),o=window.navigator.userLanguage||window.navigator.language;this._state={referrer:i,pathname:window.location.pathname,lang:q[o]?o:"en",initing:!0},this._marks=[],c.call(this),p.call(this),f.call(this),window._tmr.push({id:e.isMobile?e.touchCounter:e.counter,type:"pageView",start:(new Date).getTime()}),g.call(this),l.call(this),d.call(this),this._state.initing=!1}var v="_mediator",b=window.document,w=window._mediatorUtils;if(w){var _=w.extend,y=w.offset,C=w.addClass,E=w.debounce,S=w.isMobile,x={};window[v]&&(x=window[v]);var k={cssSels:{scrollCont:".js-mediator-container",article:".js-mediator-article",footer:".js-mediator-footer",section:".js-mediator-section"},cssClss:{mark:"js-mediator-mark"},attrs:{useSection:"data-use-section",counter:"data-counter",touchCounter:"data-mobile-counter",adaptive:"data-adaptive"},section:{minHeight:0,count:3,triggerStep:0},timeouts:{sleep:3e4,hit:5e3,height:2e3,scroll:300,resize:500},counter:null,showRule:!1,sectionByClass:!1,triggerArea:.33,style:{mark:"position: absolute; left: 0px; right: 0px; height: 4px; z-index: 99; background: #F44E4E;",label:"position: relative; top: -28px; left: 16px; font-family: Arial; font-size: 15px; color: white; background: #F44E4E; line-height: 32px; padding: 0 16px; display: inline-block; border-radius: 3px;"},hashes:{showRule:"mediator",debug:"mediator-debug"},debug:!1,onPushEvent:null},q={ru:{start:"Начало",end:"Конец",section:"секции",footer:"подвала"},en:{start:"Begin",end:"End",section:"section",footer:"footer"}},T=function(){function t(){_(!0,this,x);var t=b.getElementById("js-mpf-mediator-init"),e=k.attrs,i={counter:parseInt(t.getAttribute(e.counter)),touchCounter:parseInt(t.getAttribute(e.touchCounter)),sectionByClass:"true"===t.getAttribute(e.useSection),adaptive:"true"===t.getAttribute(e.adaptive)};if(i.adaptive&&(!i.counter||!i.touchCounter))return void console.error("Mediator: неверно настроены счётчики для адаптивной вёрстки");i.counter&&i.touchCounter&&(i.adaptive=!0);var o=this._opts=_(!0,{},k,i,this._opts);if(isNaN(o.counter)&&o.debug&&console.warn("Mediator: неверно указан ID счётчика"),!o.counter&&isNaN(o.touchCounter)&&o.debug&&console.warn("Mediator: неверно указан ID счётчика для мобильного устройства"),!o.counter&&!o.touchCounter)return void console.error("Mediator: неверно настроены счётчики");var n=o.cssSels,s=b.querySelector(n.scrollCont);s||(s=b.querySelector("body"));var r=this._elems={parent:s,article:s.querySelector(n.article),footer:s.querySelector(n.footer)};if(o.sectionByClass){if(r.section=s.querySelectorAll(o.cssSels.section),!r.section.length)return void(o.debug&&console.error("Mediator: не найдена ни одна секция"))}else if(r.article||(r.article=s.querySelector("article")),!r.article)return void(o.debug&&console.error('Mediator: не найден блок "article"'));r.footer||(r.footer=s.querySelector("footer")),m.call(this)}(function e(){return!1 in window?void setTimeout(e.bind(this),300):void t.call(this)}).call(this)};window[v]=new T}}();
//# sourceMappingURL=mpf-mediator.min.js.map
